### 组包拆包传输协议

**初始约定,协议包:**

```c
/* 包的实际大小取决于当前通信信道的最小负载 */
#pragma pack(push, 1)
typedef struct {
    uint16_t chan:2;    /* 此包使用的传输信道 */
    uint16_t head:1;    /* 起始协议包(多协议包传输开始标记) */
    uint16_t tail:1;    /* 终止协议包(多协议包传输结束标记) */
    uint16_t size:12;   /* 动态数据流长度 */
    uint8_t  data[0];   /* 动态数据流 */
} app_module_transfer_t;
#pragma pack(pop)
```

| --------- | --------------------------------------------- |
| 字段      | 定义                                          |
| --------- | --------------------------------------------- |
| head      | 此包使用的传输信道,低速和高速,例BLE和BT       |
| head      | 首包标记,多包传输时拆包组包使用,单包固定为1   |
| tail      | 尾包标记,多包传输时拆包组包使用,单包固定为1   |
| size      | 动态数据流长度                                |
| data      | 动态数据流                                    |
| --------- | --------------------------------------------- |

**=====**
**注意:** 不同的设备依照传输框架生成传输数据流
**=====** 传输双方分别拥有一个发送和一个接收信道
**=====** 理论上这俩个信道可以并发进行,但设备交互应该遵从问答模式
**=====** 上层对数据流的传输框架与本次的组包拆包协议互不相关
**=====** 本次对数据包只负责组包,不考虑丢包以及错位包的情况
**=====** 这些内容由底层的通信信道来保证
